# Copilot Session Handoff

> **Last Updated:** January 15, 2026
> **Last Commit:** `55937c9` - feat(aggrid): add Context Menu

---

## üéØ Current Project: Global UI Components Library

Building a **configuration-driven, generic UI component library** for a multi-tenant SaaS Laravel application.

### Design Principles (MUST FOLLOW)

1. **Configuration over convention** - Every feature is opt-in via props
2. **No hard-coding** - All text, colors, icons configurable
3. **Backward compatible** - New features don't break existing usage
4. **No external libraries for core features** - Use vanilla JS where possible
5. **Abstract definitions** - Column schemas work across different table implementations

---

## ‚úÖ Completed Work

### DataTable Component (`x-table.datatable.base`)

**Location:** `resources/views/components/table/datatable/base.blade.php`

| Feature              | Props                                                            | Status |
| -------------------- | ---------------------------------------------------------------- | ------ |
| Static Data          | `:data="$array"`                                                 | ‚úÖ     |
| Server-Side AJAX     | `ajax-url`, `:server-side="true"`                                | ‚úÖ     |
| Column Config        | `:columns="[...]"` with key, label, sortable, searchable, render | ‚úÖ     |
| Pagination           | `:pagination="true"`, `:page-length="25"`                        | ‚úÖ     |
| Search               | `:searchable="true"`                                             | ‚úÖ     |
| Row Selection        | `:selectable="true"`, `row-key`                                  | ‚úÖ     |
| Bulk Actions         | `:bulk-actions="[...]"`, `on-bulk-action`                        | ‚úÖ     |
| Column Visibility    | `:show-column-toggle="true"`                                     | ‚úÖ     |
| Column Reordering    | `:column-reorderable="true"` (vanilla JS drag & drop)            | ‚úÖ     |
| Export               | `:exportable="true"`, `:export-buttons="['csv','excel','pdf']"`  | ‚úÖ     |
| Cell Renderers (16+) | `'render' => 'badge\|currency\|date\|avatar\|...'`               | ‚úÖ     |
| Actions Column       | `:show-actions="true"` with slot                                 | ‚úÖ     |
| Empty States         | `<x-slot:empty>`                                                 | ‚úÖ     |
| Callbacks            | `on-init`, `on-row-click`, `on-selection-change`                 | ‚úÖ     |

**JS API:** `window.GeoTable.*`

---

### AG Grid Component (`x-table.aggrid.base`)

**Location:** `resources/views/components/table/aggrid/base.blade.php`

#### ‚úÖ P0 Features (Implemented)

| Feature                | Props                                                        | Status |
| ---------------------- | ------------------------------------------------------------ | ------ |
| Static Data            | `:data="$array"`                                             | ‚úÖ     |
| AJAX Data              | `ajax-url="/api/..."`                                        | ‚úÖ     |
| Column Config          | `:columns="[...]"`                                           | ‚úÖ     |
| Sorting                | `:sortable="true"`, `:multi-sort="true"`                     | ‚úÖ     |
| Filtering              | `:filterable="true"`, `'filter' => 'text\|number\|date'`     | ‚úÖ     |
| Floating Filters       | `:floating-filter="true"`                                    | ‚úÖ     |
| Quick Filter           | `:quick-filter="true"`                                       | ‚úÖ     |
| Pagination             | `:pagination="true"`, `:page-size="25"`                      | ‚úÖ     |
| Row Selection          | `:selectable="true"`, `selection-mode="multiple"`            | ‚úÖ     |
| Checkbox Selection     | `:checkbox-selection="true"`, `:header-checkbox="true"`      | ‚úÖ     |
| Column Resizing        | `:resizable="true"`                                          | ‚úÖ     |
| Column Pinning         | `'pinned' => 'left\|right'`                                  | ‚úÖ     |
| Cell Renderers         | 16+ types (same as DataTable)                                | ‚úÖ     |
| Themes                 | `theme="quartz\|alpine\|balham\|material"`                   | ‚úÖ     |
| Dark Mode              | `:dark-mode="true"`                                          | ‚úÖ     |
| CSV Export             | `:exportable="true"`                                         | ‚úÖ     |
| State Persistence      | `:state-save="true"`                                         | ‚úÖ     |
| Actions Column         | `:show-actions="true"`                                       | ‚úÖ     |
| Callbacks              | `on-init`, `on-row-click`, `on-selection-change`, etc.       | ‚úÖ     |
| Server-Side Data Model | `:server-side="true"`, `ajax-url`                            | ‚úÖ     |
| Infinite Scroll        | `:server-side-infinite="true"`                               | ‚úÖ     |
| Server Callbacks       | `on-server-request`, `on-server-response`, `on-server-error` | ‚úÖ     |

#### ‚úÖ P1 Features (Just Implemented!)

| Feature                 | Props                                                       | Status |
| ----------------------- | ----------------------------------------------------------- | ------ |
| **Inline Cell Editing** | `:editable="true"`, `edit-type="cell\|fullRow"`             | ‚úÖ     |
| Cell Editors            | `'editor' => 'text\|number\|select\|textarea\|date'`        | ‚úÖ     |
| Editor Options          | `'min'`, `'max'`, `'precision'`, `'options'`, `'maxLength'` | ‚úÖ     |
| Undo/Redo               | `:undo-redo-cell-editing="true"`                            | ‚úÖ     |
| Cell Validation         | `'validator' => 'required\|email\|{custom}'`                | ‚úÖ     |
| Edit Callbacks          | `on-cell-value-changed`, `on-row-value-changed`             | ‚úÖ     |
| **Row Dragging**        | `:row-draggable="true"`, `:row-drag-managed="true"`         | ‚úÖ     |
| Full Row Drag           | `:row-drag-entire-row="true"` (drag from anywhere)          | ‚úÖ     |
| Multi-Row Drag          | `:row-drag-multi-row="true"` (drag selected rows)           | ‚úÖ     |
| Drag Callbacks          | `on-row-drag-end`, `on-row-drag-move`                       | ‚úÖ     |

**JS API (Editing):**

```javascript
GeoGrid.startEditing(gridId, rowIndex, colKey);
GeoGrid.stopEditing(gridId, cancel);
GeoGrid.undoCellEdit(gridId);
GeoGrid.redoCellEdit(gridId);
GeoGrid.updateCellValue(gridId, rowKey, colKey, newValue);
```

**JS API (Row Dragging):**

```javascript
GeoGrid.getRowOrder(gridId); // Get all rows in current order
GeoGrid.getRowOrderIds(gridId); // Get just IDs in order
GeoGrid.moveRow(gridId, from, to); // Move row programmatically
GeoGrid.resetRowOrder(gridId); // Reset to original order
```

#### ‚úÖ P2 Feature - Context Menu (Just Implemented!)

| Feature            | Props                                                  | Status |
| ------------------ | ------------------------------------------------------ | ------ |
| **Context Menu**   | `:context-menu="true"`                                 | ‚úÖ     |
| Custom Menu Items  | `:context-menu-items="[...]"` with action, label, icon | ‚úÖ     |
| Dividers & Headers | `['divider' => true]`, `['header' => 'Section']`       | ‚úÖ     |
| Dynamic Visibility | `'visible' => fn($row)`, `'disabled' => fn($row)`      | ‚úÖ     |
| Action Callbacks   | `on-context-menu-action`                               | ‚úÖ     |
| Custom Styling     | `context-menu-class="..."`                             | ‚úÖ     |

**JS API (Context Menu):**

```javascript
GeoGrid.showContextMenu(gridId, rowData, x, y); // Show menu programmatically
GeoGrid.hideContextMenu(gridId); // Hide menu
GeoGrid.setContextMenuItems(gridId, items); // Update menu items dynamically
GeoGrid.getContextMenuItems(gridId); // Get current menu items
```

---

## üîú Next Tasks: AG Grid P2 Features (Remaining)

| Feature                | Description                 | Notes                       |
| ---------------------- | --------------------------- | --------------------------- |
| **Row Grouping**       | Group rows by column values | Enterprise feature          |
| **Master/Detail**      | Expandable row details      | Enterprise feature          |
| **Excel Export**       | Export to .xlsx             | Enterprise feature          |
| ~~Context Menu~~       | ~~Right-click actions~~     | ‚úÖ Done (custom vanilla JS) |
| **Column Aggregation** | Sum, avg, count in footers  | Enterprise feature          |
| **Clipboard**          | Copy/paste support          | Enterprise feature          |

---

## üìÅ Key Files

```
app/
‚îú‚îÄ‚îÄ resources/views/components/table/
‚îÇ   ‚îú‚îÄ‚îÄ datatable/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base.blade.php      # DataTable component (~2340 lines)
‚îÇ   ‚îî‚îÄ‚îÄ aggrid/
‚îÇ       ‚îî‚îÄ‚îÄ base.blade.php      # AG Grid component (~2200 lines)
‚îú‚îÄ‚îÄ resources/views/core-ui/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ showcase.blade.php  # Component showcase page (~2200 lines)
‚îÇ   ‚îî‚îÄ‚îÄ layouts/
‚îÇ       ‚îî‚îÄ‚îÄ showcase.blade.php  # Showcase layout
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ web.php                 # /components route
```

---

## üöÄ Quick Start Commands

```bash
# Start Docker environment
docker-compose -f docker-compose.local.yml up -d

# View showcase page
# URL: http://localhost:8000/components

# Clear view cache if issues
docker exec php php artisan view:clear

# Fix permissions if needed
docker exec php chmod -R 777 /var/www/html/storage /var/www/html/bootstrap/cache
```

---

## üìã Implementation Guidelines

When implementing new features:

1. **Add props** at the top of the component with defaults
2. **Add to config array** that gets passed to JavaScript
3. **Implement in JS** (GeoGrid object)
4. **Add showcase demo** with working example
5. **Update feature tracker** in showcase page

### Column Definition Schema (Both Components)

```php
[
    'key' => 'field_name',
    'label' => 'Display Name',
    'sortable' => true,
    'filter' => 'text|number|date|set',
    'visible' => true,
    'width' => 100,
    'flex' => 1,
    'pinned' => 'left|right',
    'render' => 'badge|currency|date|...',
    'class' => 'text-center',

    // EDITING (AG Grid only)
    'editable' => true,
    'editor' => 'text|number|select|textarea|date|checkbox',
    'options' => ['opt1', 'opt2'],  // for select editor
    'min' => 0,                      // for number editor
    'max' => 100,                    // for number editor
    'validator' => 'required|email', // validation
]
```

---

## ‚ö†Ô∏è Important Notes

1. **AG Grid Version:** Using Community edition (v32.3.3) via CDN
2. **Enterprise Features:** Row Grouping, Master/Detail, Excel Export require Enterprise license
3. **No jQuery in AG Grid:** AG Grid is vanilla JS, unlike DataTable
4. **State Persistence:** Uses localStorage with key `geo-grid-state-{id}`
5. **Docker Port:** http://localhost:8000

---

_Delete this file after reading or keep it updated for future sessions._
